/**
 * FALLBACK DATA для RETRO-PC STORE
 * Демонстраційні товари з оптимізованими зображеннями у форматі WebP
 * Використовується коли eBay API недоступний
 */

window.fallbackProducts = [
    {
        title: "Intel 8086 CPU - Vintage 16-bit Processor (1978)",
        currentPrice: "$89.99",
        condition: "Used - Excellent",
        location: "Silicon Valley, CA",
        viewItemURL: "#demo-intel-8086",
        // Оптимізовані зображення у форматі WebP з fallback
        galleryURL: "/assets/img/fallback/intel-8086.webp",
        galleryURLJPG: "/assets/img/Intel_8086-2.jpg", // Fallback для старих браузерів
        imageAVIF: "/assets/img/fallback/intel-8086.avif", // Найновіший формат
        imageAlt: "Intel 8086 16-bit microprocessor from 1978, ceramic DIP package"
    },
    {
        title: "Intel 8088 CPU - IBM PC Compatible Processor",
        currentPrice: "$75.50",
        condition: "Used - Good",
        location: "Austin, TX",
        viewItemURL: "#demo-intel-8088",
        galleryURL: "/assets/img/fallback/intel-8088.webp",
        galleryURLJPG: "/assets/img/Intel_8088-2.jpg",
        imageAVIF: "/assets/img/fallback/intel-8088.avif",
        imageAlt: "Intel 8088 microprocessor, 8-bit external bus variant of 8086"
    },
    {
        title: "Intel 8087 Math Coprocessor FPU - Floating Point Unit",
        currentPrice: "$125.00",
        condition: "Used - Very Good",
        location: "Portland, OR",
        viewItemURL: "#demo-intel-8087",
        galleryURL: "/assets/img/fallback/intel-8087.webp",
        galleryURLJPG: "/assets/img/Intel_8087.jpg",
        imageAVIF: "/assets/img/fallback/intel-8087.avif",
        imageAlt: "Intel 8087 floating-point coprocessor for mathematical calculations"
    },
    {
        title: "IBM PC XT Motherboard - Complete Vintage System Board",
        currentPrice: "$299.99",
        condition: "Used - Fair",
        location: "Boston, MA",
        viewItemURL: "#demo-ibm-xt-board",
        galleryURL: "/assets/img/fallback/ibm-xt-motherboard.webp",
        galleryURLJPG: "/assets/img/fallback/ibm-xt-motherboard.jpg",
        imageAVIF: "/assets/img/fallback/ibm-xt-motherboard.avif",
        imageAlt: "IBM PC XT motherboard with 8088 CPU socket and expansion slots"
    },
    {
        title: "CGA Graphics Card - Color Graphics Adapter (1981)",
        currentPrice: "$149.95",
        condition: "Used - Good",
        location: "San Francisco, CA",
        viewItemURL: "#demo-cga-card",
        galleryURL: "/assets/img/fallback/cga-graphics-card.webp",
        galleryURLJPG: "/assets/img/fallback/cga-graphics-card.jpg",
        imageAVIF: "/assets/img/fallback/cga-graphics-card.avif",
        imageAlt: "IBM Color Graphics Adapter (CGA) card from 1981"
    },
    {
        title: "EGA Graphics Card - Enhanced Graphics Adapter (1984)",
        currentPrice: "$199.99",
        condition: "Used - Excellent",
        location: "Seattle, WA",
        viewItemURL: "#demo-ega-card",
        galleryURL: "/assets/img/fallback/ega-graphics-card.webp",
        galleryURLJPG: "/assets/img/fallback/ega-graphics-card.jpg",
        imageAVIF: "/assets/img/fallback/ega-graphics-card.avif",
        imageAlt: "Enhanced Graphics Adapter (EGA) card with 640x350 resolution"
    },
    {
        title: "AdLib Sound Card - FM Synthesis Audio (1987)",
        currentPrice: "$179.50",
        condition: "Used - Very Good",
        location: "Chicago, IL",
        viewItemURL: "#demo-adlib-card",
        galleryURL: "/assets/img/fallback/adlib-sound-card.webp",
        galleryURLJPG: "/assets/img/fallback/adlib-sound-card.jpg",
        imageAVIF: "/assets/img/fallback/adlib-sound-card.avif",
        imageAlt: "AdLib Music Synthesizer Card with Yamaha YM3812 chip"
    },
    {
        title: "Sound Blaster 1.0 - Creative Labs Audio Card",
        currentPrice: "$249.00",
        condition: "Used - Good",
        location: "Miami, FL",
        viewItemURL: "#demo-soundblaster",
        galleryURL: "/assets/img/fallback/sound-blaster.webp",
        galleryURLJPG: "/assets/img/fallback/sound-blaster.jpg",
        imageAVIF: "/assets/img/fallback/sound-blaster.avif",
        imageAlt: "Creative Labs Sound Blaster 1.0 audio card"
    },
    {
        title: "IBM PC 5.25\" Floppy Drive - Tandon TM-100-2A",
        currentPrice: "$85.00",
        condition: "Used - Fair",
        location: "Denver, CO",
        viewItemURL: "#demo-floppy-drive",
        galleryURL: "/assets/img/fallback/floppy-drive.webp",
        galleryURLJPG: "/assets/img/fallback/floppy-drive.jpg",
        imageAVIF: "/assets/img/fallback/floppy-drive.avif",
        imageAlt: "Tandon TM-100-2A 5.25 inch floppy disk drive"
    },
    {
        title: "Hercules Graphics Card - Monochrome High Resolution",
        currentPrice: "$119.99",
        condition: "Used - Excellent",
        location: "Phoenix, AZ",
        viewItemURL: "#demo-hercules-card",
        galleryURL: "/assets/img/fallback/hercules-card.webp",
        galleryURLJPG: "/assets/img/fallback/hercules-card.jpg",
        imageAVIF: "/assets/img/fallback/hercules-card.avif",
        imageAlt: "Hercules Graphics Card with 720x348 monochrome resolution"
    },
    {
        title: "8-bit ISA Memory Expansion Card - 512KB RAM",
        currentPrice: "$65.99",
        condition: "Used - Good",
        location: "Atlanta, GA",
        viewItemURL: "#demo-memory-card",
        galleryURL: "/assets/img/fallback/memory-card.webp",
        galleryURLJPG: "/assets/img/fallback/memory-card.jpg",
        imageAVIF: "/assets/img/fallback/memory-card.avif",
        imageAlt: "8-bit ISA memory expansion card with 512KB RAM"
    },
    {
        title: "Original IBM PC Keyboard - Model F (1981)",
        currentPrice: "$199.50",
        condition: "Used - Very Good",
        location: "New York, NY",
        viewItemURL: "#demo-ibm-keyboard",
        galleryURL: "/assets/img/fallback/ibm-keyboard.webp",
        galleryURLJPG: "/assets/img/fallback/ibm-keyboard.jpg",
        imageAVIF: "/assets/img/fallback/ibm-keyboard.avif",
        imageAlt: "IBM Model F keyboard from original IBM PC"
    }
];

/**
 * Отримує випадкові товари з fallback списку
 * @param {number} count - Кількість товарів для повернення
 * @returns {Array} Масив випадкових товарів
 */
window.getRandomFallbackProducts = function(count = 8) {
    const shuffled = [...window.fallbackProducts].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, count);
};

/**
 * Генерує оптимізовані URL для зображень з підтримкою різних форматів
 * @param {string} basePath - Базовий шлях до зображення
 * @returns {Object} Об'єкт з URL для різних форматів
 */
window.generateOptimizedImageUrls = function(basePath) {
    return {
        avif: basePath.replace(/\.(webp|jpg|jpeg|png)$/i, '.avif'),
        webp: basePath.replace(/\.(jpg|jpeg|png)$/i, '.webp'), 
        original: basePath
    };
};

/**
 * Перевіряє підтримку формату зображень браузером
 * @param {string} format - Формат для перевірки ('avif', 'webp')
 * @returns {Promise<boolean>} Promise що резолвиться в true якщо формат підтримується
 */
window.checkImageFormatSupport = function(format) {
    return new Promise((resolve) => {
        const testImages = {
            avif: 'data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgABogQEAwgMg8f8D///8WfhwB8+ErK42A=',
            webp: 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA'
        };
        
        if (!testImages[format]) {
            resolve(false);
            return;
        }
        
        const img = new Image();
        img.onload = () => resolve(true);
        img.onerror = () => resolve(false);
        img.src = testImages[format];
    });
};

// Ініціалізуємо перевірку підтримки форматів при завантаженні
window.imageFormatSupport = {
    avif: false,
    webp: false
};

// Асинхронна перевірка підтримки форматів
(async function initImageFormatSupport() {
    try {
        window.imageFormatSupport.avif = await window.checkImageFormatSupport('avif');
        window.imageFormatSupport.webp = await window.checkImageFormatSupport('webp');
        
        console.log('🖼️ Image format support:', window.imageFormatSupport);
    } catch (error) {
        console.warn('⚠️ Error checking image format support:', error);
    }
})();

console.log('📦 Fallback products loaded:', window.fallbackProducts.length, 'items with optimized WebP images');